<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Canvas</title>
<style type="text/css">
body {
    background-color: gray;
}
canvas {
    background-color: white;
}
</style>
</head>
<body>
<canvas id="myCanvas" width="800" height="500"></canvas>
<script type="text/javascript">
const myCanvas = document.getElementById("myCanvas");
const ctx = myCanvas.getContext("2d");

var walls = [];
class Rectangulo {
    constructor(color, w, h, x, y) {
        this.color = color;
        this.w = w;
        this.h = h;
        this.x = x;
        this.y = y;
    }
    collision(otro) {
        if (
            this.x < otro.x + otro.w &&
            this.x + this.w > otro.x &&
            this.y < otro.y + otro.h &&
            this.y + this.h > otro.y
        ){
            return true;
        }
        return false;
    }
}
var player = new Rectangulo("red", 30, 30, 100, 100);
var target = new Rectangulo("black", 10, 10, 200, 200);
//Arriba y abajo
walls.push(new Rectangulo("blue", 375, 5, 5, 0));
walls.push(new Rectangulo("blue", 375, 5, 425, 0));
walls.push(new Rectangulo("blue", 375, 5, 5, 495));
walls.push(new Rectangulo("blue", 375, 5, 425, 495));
//Izquierda y derecha
walls.push(new Rectangulo("blue", 5, 200, 0, 0));
walls.push(new Rectangulo("blue", 5, 250, 0, 250));
walls.push(new Rectangulo("blue", 5, 200, 795, 0));
walls.push(new Rectangulo("blue", 5, 250, 795, 250));

var direccion = '';
var mov = 1.5;
var coin = 0;
var coinSound = new Audio('donkey-kong-coin.mp3');
var pause = false;
var pacmanIcon = new Image();
pacmanIcon.src = 'pacman_icon.png';

document.addEventListener('keypress', function (e) {
    switch (e.keyCode) {
        case 119: // w
            direccion = 'up';
            break;
        case 115: // s
            direccion = 'down';
            break;
        case 97: // a
            direccion = 'left';
            break;
        case 100: // d
            direccion = 'right';
            break;
        case 32: // space
            pause = !pause;
            break;
    }
});

function update() {
    if (!pause) {
        switch (direccion) {
            case 'up':
                player.y -= mov;
                if (player.y < 0) {
                    player.y = myCanvas.height - player.h;
                }
                break;
            case 'down':
                player.y += mov;
                if (player.y > myCanvas.height) {
                    player.y = 0;
                }
                break;
            case 'right':
                player.x += mov;
                if (player.x > myCanvas.width) {
                    player.x = 0;
                }
                break;
            case 'left':
                player.x -= mov;
                if (player.x < 0) {
                    player.x = myCanvas.width - player.w;
                }
                break;
        }

        if (player.collision(target)) {
            coin += 10;
            target.x = Math.floor(Math.random() * (myCanvas.width - target.w));
            target.y = Math.floor(Math.random() * (myCanvas.height - target.h));
            coinSound.play();
        }

        walls.forEach(function (wall) {
            if (player.collision(wall)) {
                switch (direccion) {
                    case 'up':
                        player.y += mov;
                        break;
                    case 'down':
                        player.y -= mov;
                        break;
                    case 'left':
                        player.x += mov;
                        break;
                    case 'right':
                        player.x -= mov;
                        break;
                }
            }
        });
    }
}

function paint() {
    ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
    if (pause) {
        ctx.fillStyle = "black";
        ctx.font = '30px Arial';
        ctx.fillText("Juego en pausa", myCanvas.width / 2 - 100, myCanvas.height / 2);
    } else {
        ctx.drawImage(pacmanIcon, player.x, player.y, player.w, player.h);
        
        ctx.fillStyle = "red";
        ctx.font = '35px Arial';
        ctx.fillText("Coin: " + coin, 350, 50);

        ctx.fillStyle = target.color;
        ctx.fillRect(target.x, target.y, target.w, target.h);
        ctx.strokeRect(target.x, target.y, target.w, target.h);

        walls.forEach(function (wall) {
            ctx.fillStyle = wall.color;
            ctx.fillRect(wall.x, wall.y, wall.w, wall.h);
            ctx.strokeRect(wall.x, wall.y, wall.w, wall.h);
        });

        update();
    }

    requestAnimationFrame(paint);
}
requestAnimationFrame(paint);
</script>
</body>
</html>